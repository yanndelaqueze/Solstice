<h1 class= "title">DÃ©finir une zone</h1>
<div class="container">
  <%= form_with(model: @polygon, local: true) do |form| %>
    <div class="field">
      <%= form.label :name, 'Nom' %>
      <%= form.text_field :name, placeholder: Polygon.last.name %>
      <%= form.hidden_field :coordinates, id: "polygon_coordinates" %>
    </div>


    <div id="map" style="width: 100%; height: 400px;"></div>

    <div class="actions">
      <%= form.submit 'Enregistrer', class:"btn-action" %>
    </div>
  <% end %>

  <%= link_to 'Back', admin_path %>
</div>






<script>
  mapboxgl.accessToken = '<%= ENV['MAPBOX_API_KEY'] %>';

  // Initialize the Mapbox map
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [55.565520, -21.355710], // Initial center coordinates
    zoom: 12, // Initial zoom level
    attributionControl: true
  });

  // Add navigation controls (pan, zoom, etc.)
  map.addControl(new mapboxgl.NavigationControl());

  // Initialize a drawing tool
  const draw = new MapboxDraw({
    displayControlsDefault: false,
    controls: {
      polygon: true, // Enable polygon drawing
      trash: true // Allow users to delete drawn shapes
    }
  });

  map.addControl(draw);

  // When the user creates a polygon, store its coordinates in the form input
  map.on('draw.create', function (e) {
    const geojson = draw.getAll();
    if (geojson.features.length > 0) {
      const coordinates = geojson.features[0].geometry.coordinates;
      document.querySelector('#polygon_coordinates').value = JSON.stringify(coordinates);
    }
  });
</script>
