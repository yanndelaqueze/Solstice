<h1 class= "title">Zone de Livraison</h1>
<div class="container">
  <div class="map">
    <div id="map" style="width: 100%; height: 400px;"></div>
    <% if current_user.present? && current_user.admin %>
      <%= link_to "Modifier", new_polygon_path, class:"btn-action action-button"%>
    <% end %>
  </div>
</div>

<script>

mapboxgl.accessToken = '<%= ENV['MAPBOX_API_KEY'] %>';

const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v12',
  center: [55.565520, -21.355710],
  zoom: 11
});

const coordinates = [<%= JSON.parse(@polygon.coordinates) %>]

map.addControl(new mapboxgl.NavigationControl());


map.on('load', function () {
    map.addLayer({
      'id': 'polygon',
      'type': 'fill',
      'source': {
        'type': 'geojson',
        'data': {
          'type': 'Feature',
          'geometry': {
            'type': 'Polygon',
            'coordinates': coordinates
          }
        }
      },
      'layout': {},
      'paint': {
        'fill-color': '#F043AC',
        'fill-opacity': 0.5
      }
    });
  });

</script>
